<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pantauan TTD Anak - Orang Tua</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #fff0f4;
      color: #333;
    }

    .container {
      max-width: 720px;
      margin: auto;
    }

    h2, h3 {
      color: #c2185b;
    }

    .summary-card, .riwayat-card, .info-card, .tanya-card, .alarm-card {
      background-color: white;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(240, 98, 146, 0.15);
      margin-bottom: 2rem;
    }

    .summary-title {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }

    .summary-value {
      font-size: 2rem;
      font-weight: bold;
    }

    .risk-status {
      font-weight: bold;
      margin-top: 0.5rem;
    }

    .risk-rendah { color: green; }
    .risk-sedang { color: orange; }
    .risk-tinggi { color: red; }

    .progress-circle {
      width: 100px;
      height: 100px;
    }

    .riwayat-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .riwayat-thumbnail {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 8px;
    }

    .riwayat-detail {
      flex: 1;
    }

    .riwayat-detail strong {
      display: block;
      margin-bottom: 0.25rem;
    }

    .info-card ul {
      padding-left: 1.2rem;
    }

    .info-card li {
      margin-bottom: 0.5rem;
    }

    .tanya-card textarea {
      width: 100%;
      border: 1px solid #ccc;
      padding: 0.5rem;
      border-radius: 8px;
      resize: vertical;
    }

    .tanya-card button {
      margin-top: 0.75rem;
      background: #d81b60;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
    }

    .tanya-card button:hover {
      background: #ad1457;
    }

    /* Pop-up form styles */
    #dataAnakModal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #dataAnakModal .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    #dataAnakModal label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: bold;
    }

    #dataAnakModal input {
      width: 100%;
      padding: 0.4rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    #dataAnakModal button {
      background: #d81b60;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      width: 100%;
    }

    #dataAnakModal button:hover {
      background: #ad1457;
    }

    /* Alarm test button styling */
    .alarm-test-btn {
      display: inline-block;
      margin-top: 1rem;
      background: #d81b60;
      color: white;
      border: none;
      padding: 0.8rem 1.4rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
      user-select: none;
    }

    .alarm-test-btn:hover {
      background: #ad1457;
    }

    /* Alarm add form */
    .alarm-card label {
      display: block;
      margin-top: 0.75rem;
      font-weight: bold;
    }

    .alarm-card input, .alarm-card select {
      width: 100%;
      padding: 0.4rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
      margin-top: 0.3rem;
    }

    .alarm-card button.add-alarm-btn {
      margin-top: 1rem;
      background: #388e3c;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 1rem;
    }

    .alarm-card button.add-alarm-btn:hover {
      background: #2e7d32;
    }

    /* Daftar alarm */
    .alarm-list {
      margin-top: 1rem;
    }

    .alarm-list-item {
      background: #fce4ec;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .alarm-list-item button.delete-alarm-btn {
      background: #d32f2f;
      border: none;
      color: white;
      border-radius: 8px;
      padding: 0.2rem 0.6rem;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }

    .alarm-list-item button.delete-alarm-btn:hover {
      background: #9a0007;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Pantauan Konsumsi TTD Anak</h2>

    <div class="summary-card">
      <div>
        <div class="summary-title">Total Konsumsi Mingguan:</div>
        <div id="summaryValue" class="summary-value">0/0</div>
        <div id="riskStatus" class="risk-status"></div>
      </div>
      <svg class="progress-circle" viewBox="0 0 36 36">
        <path fill="none" stroke="#eee" stroke-width="4"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831
              a 15.9155 15.9155 0 0 1 0 -31.831" />
        <path id="progressBar" fill="none" stroke="#d81b60" stroke-width="4" stroke-dasharray="0,100"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831
              a 15.9155 15.9155 0 0 1 0 -31.831" />
      </svg>
    </div>

    <h3>Riwayat Minum TTD</h3>
    <div id="riwayatContainer" class="riwayat-card"></div>

    <h3>Edukasi Penting untuk Orang Tua</h3>
    <div class="info-card">
      <ul>
        <li><strong>TTD</strong> penting untuk mencegah anemia dan meningkatkan konsentrasi belajar anak.</li>
        <li>Berikan makanan kaya zat besi seperti daging, hati ayam, dan sayuran hijau.</li>
        <li>Minum TTD seminggu sekali cukup, tetapi harus rutin.</li>
        <li>Jika anak mual, pastikan tablet diminum setelah makan dan cukup air putih.</li>
      </ul>
    </div>

    <h3>Informasi Kesehatan Anak</h3>
    <div id="infoAnak" class="info-card"></div>

    <h3>Tanya Petugas atau Guru</h3>
    <div class="tanya-card">
      <label for="pertanyaan">Tulis pertanyaan atau saran Anda:</label><br>
      <textarea id="pertanyaan" rows="4" placeholder="Contoh: Anak saya merasa pusing setelah minum TTD..."></textarea>
      <br />
      <button onclick="alert('Pertanyaan Anda telah dikirim.')">Kirim</button>
    </div>

    <!-- Tambah fitur Alarm Dinamis -->
    <h3>Pengingat Alarm Minum TTD</h3>
    <div class="alarm-card">
      <label for="alarmHari">Pilih Hari</label>
      <select id="alarmHari">
        <option value="0">Minggu</option>
        <option value="1">Senin</option>
        <option value="2">Selasa</option>
        <option value="3">Rabu</option>
        <option value="4">Kamis</option>
        <option value="5">Jumat</option>
        <option value="6">Sabtu</option>
      </select>

      <label for="alarmJam">Jam (0-23)</label>
      <input type="number" id="alarmJam" min="0" max="23" value="9" />

      <label for="alarmMenit">Menit (0-59)</label>
      <input type="number" id="alarmMenit" min="0" max="59" value="0" />

      <button class="add-alarm-btn" id="addAlarmBtn">Tambah Alarm</button>

      <div class="alarm-list" id="alarmList"></div>
    </div>

    <!-- Tombol untuk tes alarm manual -->
    <button class="alarm-test-btn" id="testAlarmBtn">ðŸ”” Tes Alarm Manual</button>
  </div>

  <!-- Modal input data anak -->
  <div id="dataAnakModal" style="display:none;">
    <div class="modal-content">
      <h3>Isi Data Anak</h3>
      <form id="formDataAnak">
        <label for="namaAnak">Nama Anak</label>
        <input type="text" id="namaAnak" required />
        <label for="kelasAnak">Kelas</label>
        <input type="text" id="kelasAnak" required />
        <label for="statusAnemia">Status Anemia</label>
        <input type="text" id="statusAnemia" required placeholder="Contoh: Tidak Ada" />
        <label for="keluhanTerakhir">Keluhan Terakhir</label>
        <input type="text" id="keluhanTerakhir" required placeholder="Contoh: Tidak ada keluhan" />
        <button type="submit">Simpan Data</button>
      </form>
    </div>
  </div>

  <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

  <script>
    // -----------------------
    // Ambil data dummy riwayat minum TTD
    const riwayatDummy = [
      {
        tanggal: '2024-06-01',
        jam: '09:00',
        status: 'Sudah Minum',
        foto: 'https://via.placeholder.com/64?text=Minum1',
        catatan: 'Minum dengan lancar'
      },
      {
        tanggal: '2024-06-08',
        jam: '09:10',
        status: 'Belum Minum',
        foto: 'https://via.placeholder.com/64?text=Minum2',
        catatan: 'Anak agak mual'
      },
      {
        tanggal: '2024-06-15',
        jam: '09:05',
        status: 'Sudah Minum',
        foto: 'https://via.placeholder.com/64?text=Minum3',
        catatan: 'Minum sambil makan'
      }
    ];

    // -----------------------
    // Fungsi menampilkan riwayat minum TTD
    function renderRiwayat() {
      const container = document.getElementById('riwayatContainer');
      container.innerHTML = '';
      riwayatDummy.forEach(item => {
        const el = document.createElement('div');
        el.className = 'riwayat-item';
        el.innerHTML = `
          <img class="riwayat-thumbnail" src="${item.foto}" alt="Foto Minum TTD" />
          <div class="riwayat-detail">
            <strong>${item.tanggal} ${item.jam}</strong>
            <span>Status: ${item.status}</span><br />
            <small>${item.catatan}</small>
          </div>
        `;
        container.appendChild(el);
      });
    }

    // -----------------------
    // Simulasi data anak dari localStorage atau form modal input
    function loadDataAnak() {
      const dataAnak = localStorage.getItem('dataAnak');
      if (dataAnak) {
        return JSON.parse(dataAnak);
      } else {
        return null;
      }
    }

    function saveDataAnak(data) {
      localStorage.setItem('dataAnak', JSON.stringify(data));
    }

    function renderInfoAnak() {
      const infoDiv = document.getElementById('infoAnak');
      const data = loadDataAnak();
      if (data) {
        infoDiv.innerHTML = `
          <p><strong>Nama:</strong> ${data.nama}</p>
          <p><strong>Kelas:</strong> ${data.kelas}</p>
          <p><strong>Status Anemia:</strong> ${data.statusAnemia}</p>
          <p><strong>Keluhan Terakhir:</strong> ${data.keluhanTerakhir}</p>
        `;
      } else {
        infoDiv.innerHTML = `<p>Data anak belum diisi.</p>`;
        showModalDataAnak();
      }
    }

    // -----------------------
    // Modal input data anak
    const modal = document.getElementById('dataAnakModal');
    const formDataAnak = document.getElementById('formDataAnak');

    function showModalDataAnak() {
      modal.style.display = 'flex';
    }

    function hideModalDataAnak() {
      modal.style.display = 'none';
    }

    formDataAnak.addEventListener('submit', e => {
      e.preventDefault();
      const nama = document.getElementById('namaAnak').value.trim();
      const kelas = document.getElementById('kelasAnak').value.trim();
      const statusAnemia = document.getElementById('statusAnemia').value.trim();
      const keluhanTerakhir = document.getElementById('keluhanTerakhir').value.trim();

      if (!nama || !kelas || !statusAnemia || !keluhanTerakhir) {
        alert('Semua kolom wajib diisi.');
        return;
      }

      saveDataAnak({ nama, kelas, statusAnemia, keluhanTerakhir });
      renderInfoAnak();
      hideModalDataAnak();
    });

    // -----------------------
    // Kalkulasi total konsumsi mingguan dari riwayat dummy
    function hitungKonsumsi() {
      // Asumsikan data tiap tanggal unik satu kali konsumsi
      const mingguIni = getMingguIniDates();
      let konsumsi = 0;
      riwayatDummy.forEach(item => {
        if (mingguIni.includes(item.tanggal) && item.status.toLowerCase().includes('sudah')) {
          konsumsi++;
        }
      });
      return konsumsi;
    }

    // Mendapatkan tanggal di minggu ini (Senin-Minggu)
    function getMingguIniDates() {
      const now = new Date();
      const hariIni = now.getDay(); // 0=minggu..6=sabtu
      // Hari Senin minggu ini
      const selisihSenin = (hariIni + 6) % 7; 
      const senin = new Date(now);
      senin.setDate(now.getDate() - selisihSenin);
      let dates = [];
      for (let i = 0; i < 7; i++) {
        const d = new Date(senin);
        d.setDate(senin.getDate() + i);
        dates.push(d.toISOString().slice(0,10));
      }
      return dates;
    }

    // Update ringkasan konsumsi mingguan dan risiko
    function updateSummary() {
      const totalKonsumsi = hitungKonsumsi();
      const targetMingguan = 1; // Asumsikan target minum 1x/minggu
      const summaryValue = document.getElementById('summaryValue');
      const riskStatus = document.getElementById('riskStatus');
      const progressBar = document.getElementById('progressBar');

      summaryValue.textContent = `${totalKonsumsi}/${targetMingguan}`;

      // Hitung persen progres
      let persen = Math.min(100, (totalKonsumsi / targetMingguan) * 100);
      // Stroke dasharray trick untuk circle progress
      progressBar.setAttribute('stroke-dasharray', `${persen}, 100`);

      // Status risiko
      let statusText = '';
      let className = '';
      if (totalKonsumsi >= targetMingguan) {
        statusText = 'Risiko Rendah';
        className = 'risk-rendah';
      } else if (totalKonsumsi > 0) {
        statusText = 'Risiko Sedang';
        className = 'risk-sedang';
      } else {
        statusText = 'Risiko Tinggi';
        className = 'risk-tinggi';
      }
      riskStatus.textContent = statusText;
      riskStatus.className = `risk-status ${className}`;
    }

    // -----------------------
    // Alarm Pengingat TTD dinamis

    // Ambil alarm dari localStorage
    function loadAlarms() {
      const alarms = localStorage.getItem('alarms');
      if (alarms) {
        return JSON.parse(alarms);
      }
      return [];
    }

    // Simpan alarm ke localStorage
    function saveAlarms(alarms) {
      localStorage.setItem('alarms', JSON.stringify(alarms));
    }

    // Render daftar alarm di UI
    function renderAlarmList() {
      const alarmListDiv = document.getElementById('alarmList');
      const alarms = loadAlarms();
      if (alarms.length === 0) {
        alarmListDiv.innerHTML = '<p>Belum ada alarm.</p>';
        return;
      }
      alarmListDiv.innerHTML = '';
      alarms.forEach((alarm, index) => {
        const hariNama = ['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'][alarm.hari];
        const jam = String(alarm.jam).padStart(2,'0');
        const menit = String(alarm.menit).padStart(2,'0');

        const div = document.createElement('div');
        div.className = 'alarm-list-item';
        div.innerHTML = `
          <span>${hariNama}, ${jam}:${menit}</span>
          <button class="delete-alarm-btn" data-index="${index}">Hapus</button>
        `;
        alarmListDiv.appendChild(div);
      });

      // Tambah event handler tombol hapus alarm
      const btns = alarmListDiv.querySelectorAll('.delete-alarm-btn');
      btns.forEach(btn => {
        btn.addEventListener('click', e => {
          const idx = Number(e.target.dataset.index);
          deleteAlarm(idx);
        });
      });
    }

    function deleteAlarm(index) {
      const alarms = loadAlarms();
      if (index >= 0 && index < alarms.length) {
        alarms.splice(index, 1);
        saveAlarms(alarms);
        renderAlarmList();
      }
    }

    // Tambah alarm baru
    document.getElementById('addAlarmBtn').addEventListener('click', () => {
      const hari = Number(document.getElementById('alarmHari').value);
      const jam = Number(document.getElementById('alarmJam').value);
      const menit = Number(document.getElementById('alarmMenit').value);

      if (
        isNaN(hari) || hari < 0 || hari > 6 ||
        isNaN(jam) || jam < 0 || jam > 23 ||
        isNaN(menit) || menit < 0 || menit > 59
      ) {
        alert('Mohon masukkan waktu alarm yang valid.');
        return;
      }

      const alarms = loadAlarms();
      // Cek duplikat alarm
      const adaDuplikat = alarms.some(a => a.hari === hari && a.jam === jam && a.menit === menit);
      if (adaDuplikat) {
        alert('Alarm dengan waktu ini sudah ada.');
        return;
      }

      alarms.push({ hari, jam, menit });
      saveAlarms(alarms);
      renderAlarmList();
      alert('Alarm berhasil ditambahkan.');
    });

    // -----------------------
    // Fungsi cek alarm dan trigger bunyi notifikasi
    function cekAlarm() {
      const now = new Date();
      const hariIni = now.getDay();
      const jamIni = now.getHours();
      const menitIni = now.getMinutes();

      const alarms = loadAlarms();

      alarms.forEach(alarm => {
        if (alarm.hari === hariIni && alarm.jam === jamIni && alarm.menit === menitIni) {
          bunyikanAlarm();
        }
      });
    }

    // Bunyi alarm
    function bunyikanAlarm() {
      const audio = document.getElementById('alarmSound');
      if (audio) {
        audio.play();
        alert('â° Waktunya minum TTD anak!');
      }
    }

    // Tombol tes alarm manual
    document.getElementById('testAlarmBtn').addEventListener('click', () => {
      bunyikanAlarm();
    });

    // Jalankan cek alarm setiap menit
    setInterval(cekAlarm, 60 * 1000);

    // -----------------------
    // Inisialisasi halaman
    window.onload = () => {
      renderRiwayat();
      renderInfoAnak();
      updateSummary();
      renderAlarmList();
    };
  </script>
</body>
</html>
