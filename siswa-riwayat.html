<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analisis Risiko Anemia</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #fff0f5;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(240, 98, 146, 0.2);
      padding: 2rem;
      max-width: 400px;
      width: 100%;
      margin-bottom: 2rem;
      text-align: center;
    }

    .progress-container {
      background: #eee;
      border-radius: 30px;
      overflow: hidden;
      height: 30px;
      margin-top: 1rem;
      margin-bottom: 1rem;
    }

    .progress-bar {
      height: 100%;
      background: #d81b60;
      width: 0%;
      color: white;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      transition: width 0.8s ease;
    }

    .risk-result {
      font-size: 1.1rem;
      font-weight: bold;
      margin-top: 1rem;
      color: #d81b60;
    }

    .footer {
      font-size: 0.9rem;
      color: #666;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

  <div class="card">
    <h2>Analisis Risiko Anemia</h2>
    <p>Periode: Januari – Desember</p>

    <div class="progress-container">
      <div class="progress-bar" id="progressBar">0%</div>
    </div>

    <div class="risk-result" id="riskResult">Menghitung...</div>
  </div>

  <div class="footer">
    Berdasarkan standar WHO: minimal 52 tablet TTD per tahun.
  </div>

  <script>
    function hitungKonsumsiValid() {
      const data = JSON.parse(localStorage.getItem("riwayatTTD")) || [];
      const thisYear = new Date().getFullYear();
      let validCount = 0;

      data.forEach(item => {
        const tanggalParts = item.tanggal.split("/");
        const day = parseInt(tanggalParts[0]);
        const month = parseInt(tanggalParts[1]) - 1; // month is 0-indexed
        const year = parseInt(tanggalParts[2]);
        const dateObj = new Date(year, month, day);

        const isYa = item.jawaban === "Ya";
        const hasPhoto = item.foto !== undefined || item.hasPhoto === true; // extensible
        const isThisYear = dateObj.getFullYear() === thisYear;

        if (isYa && hasPhoto && isThisYear) {
          validCount++;
        }
      });

      return validCount;
    }

    function tampilkanAnalisis() {
      const konsumsi = hitungKonsumsiValid();
      const target = 52;
      const persen = Math.round((konsumsi / target) * 100);
      const bar = document.getElementById("progressBar");
      bar.style.width = Math.min(persen, 100) + "%";
      bar.textContent = `${persen}%`;

      let risiko = "Menghitung...";
      if (konsumsi >= 52) {
        risiko = "✅ Risiko Rendah (Sangat Baik)";
      } else if (konsumsi >= 36) {
        risiko = "⚠️ Risiko Sedang (Perlu Ditingkatkan)";
      } else {
        risiko = "❌ Risiko Tinggi (Bahaya Anemia)";
      }

      document.getElementById("riskResult").textContent = risiko;
    }

    tampilkanAnalisis();
  </script>
</body>
</html>

